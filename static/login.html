<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Login</title>
    <link rel="stylesheet" type="text/css" href="login.css" />
</head>

<body>
    <div id="login">
        <h1>Login</h1>
        <div>
            <input id="username" type="text" placeholder="username" name="u"></input>
            <input id="password" type="password" placeholder="password" name="p"></input>
            <button type="button" class="but" onclick="login()">Login</button>
            <button type="button" class="but" onclick="register()">Register</button>
        </div>

    </div>
</body>

</html>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
    /*
                                                                        var username;
                                                                        var socket = new WebSocket("ws://127.0.0.1:8088/");
                                                                        socket.onopen = function() {
                                                                            var newTag = document.createElement('div');
                                                                            newTag.innerHTML = "Connection Established";
                                                                            document.getElementById('login').appendChild(newTag);
                                                                        };
                                                                        socket.onmessage = function(event) {
                                                                            var response = event.data;
                                                                            if (response == '200') {
                                                                                socket.close();
                                                                                window.location.href = "chat.html/?user=" + username.value + '&key=' + 'abc'
                                                                            }
                                                                            var newTag = document.createElement('div');
                                                                            newTag.innerHTML = response;
                                                                            document.getElementById('login').appendChild(newTag);
                                                                        };
                                                                        socket.onclose = function(event) {
                                                                            var newTag = document.createElement('div');
                                                                            newTag.innerHTML = "Connection Failed";
                                                                            document.getElementById('login').appendChild(newTag);
                                                                        };
                                                                        */

    function login() {
        let httpurl = "http://127.0.0.1:8000/api/account/login/";
        let username = document.getElementById("username");
        let password = document.getElementById("password");
        if (username == "" || username == null) {
            alert("username is empty");
            return;
        }
        if (password == "" || password == null) {
            alert("password is empty");
            return;
        }
        axios.get(httpurl, {
            params: {
                user: username.value,
                pass: password.value
            }
        }).then(function(response) {
            if (response.status == 200) {
                window.location.href = "join.html/?user=" + username.value + '&key=' + 'abc'
            } else {
                var res = response.data; //我对前端不太熟悉 这里的error message 我怎么都搞不出来
                console.log(res)
                var newTag = document.createElement('div');
                newTag.innerHTML = res;
                document.getElementById('login').appendChild(newTag);
            }
            console.log(response.status)
        }).catch(function(err) {
            console.log(err)
        });
        /*var msg = {
            type: 'login',
            username: username.value,
            password: password.value
        }
        socket.send(JSON.stringify(msg));*/
    }

    function register() {
        let httpurl = "http://127.0.0.1:8000/api/account/register/";
        let username = document.getElementById("username");
        let password = document.getElementById("password");
        if (username == "" || username == null) {
            alert("username is empty");
            return;
        }
        if (password == "" || password == null) {
            alert("password is empty");
            return;
        }
        response = axios.get(httpurl, {
            params: {
                user: username.value,
                pass: password.value
            }
        }).then(response => {
            if (response.status == 200) {
                window.location.href = "join.html/?user=" + username.value + '&key=' + 'abc'
            } else {
                var res = response.data; // 这里也是
                console.log(res)
                var newTag = document.createElement('div');
                newTag.innerHTML = res;
                document.getElementById('login').appendChild(newTag);
            }
            //console.log(response)
        }).catch(function(err) {
            console.log(err)
        });
    }
</script>